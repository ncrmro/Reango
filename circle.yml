machine:
  pre:
   - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
  services:
   - docker

general:
  artifacts:
    - ".coverage"
    - "screenshots"

dependencies:
  pre:
    - sudo pip install docker-compose
  cache_directories:
    - "~/docker"
  override:
    - docker info
    - docker-compose version
    - if [[ -e ~/docker/image.tar ]]; then docker load -i ~/docker/image.tar; fi
    - docker pull ubuntu:16.04
    - docker pull selenium/standalone-chrome-debug:3.0.1-fermium
    - docker build -t ncrmro/ango .
    - mkdir -p ~/docker
    - docker save ubuntu:16.04 ncrmro/ango selenium/standalone-chrome-debug:3.0.1-fermium > ~/docker/image.tar

test:
  override:
    - docker-compose -f docker-compose.test.yml up
