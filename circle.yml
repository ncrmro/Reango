machine:
  pre:
   - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
   - sudo pip install docker-compose

general:
  artifacts:
    - ".coverage"
    - "screenshots"

dependencies:
  cache_directories:
    - "~/docker"
  override:
      - docker info
      - if [[ -e ~/docker/image.tar ]]; then docker load -i ~/docker/image.tar; fi
      - docker pull ubuntu:16.04
      - docker pull selenium/standalone-chrome-debug:3.0.1-fermium
      - docker build -t ncrmro/ango .
      - mkdir -p ~/docker
      - docker save ubuntu:16.04 ncrmro/ango selenium/standalone-chrome-debug:3.0.1-fermium > ~/docker/image.tar

test:
  override:
    - docker run ncrmro/ango ./manage.py test ./src/apps/*
